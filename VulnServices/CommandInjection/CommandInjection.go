package main

import (
	"fmt"
	"log"
	"net/http"
	"os/exec"
)

func openRedirect(w http.ResponseWriter, r *http.Request) {
	arg := r.URL.Query().Get("arg")
	cmd := exec.Command("bash", "-c",  "echo" + " " + arg)
	log.Println(cmd)
	stdout, _ := cmd.Output()
	fmt.Fprint(w, string(stdout))
}

func renderIndex(w http.ResponseWriter, r *http.Request) {
	fmt.Fprint(w, "<a href=http://localhost:8000/redirect?redirect_to=https://google.com>Ask Google a question</a>")
}

func main() {
	fmt.Println("Starting Web Server with Command Injection vulnerability")
	http.HandleFunc("/redirect", openRedirect)
	http.HandleFunc("/", renderIndex)
	if err := http.ListenAndServe(":8000", nil); err != nil {
		log.Fatal(err)
	}
}
